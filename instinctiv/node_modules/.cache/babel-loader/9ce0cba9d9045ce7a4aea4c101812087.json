{"ast":null,"code":"import _classCallCheck from \"/Users/yash/instinctiv/instinctiv/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/yash/instinctiv/instinctiv/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/yash/instinctiv/instinctiv/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/yash/instinctiv/instinctiv/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/yash/instinctiv/instinctiv/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/yash/instinctiv/instinctiv/src/components/Stocks/index.js\";\nimport React, { Component } from \"react\";\nimport { AuthUserContext, withAuthorization } from '../Session';\nimport { Input, Button, Col, Row, Label, Card, Alert, CardText, Table } from 'reactstrap';\nimport './stocks.css';\nimport TradingViewWidget, { Themes } from 'react-tradingview-widget'; //import { Timestamp } from \"@google-cloud/firestore\";\n\nvar Stocks =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Stocks, _Component);\n\n  function Stocks(props) {\n    var _this;\n\n    _classCallCheck(this, Stocks);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Stocks).call(this, props));\n\n    _this.toggleDarkLight = function (event) {\n      var body = document.getElementById(\"body\");\n      var currentClass = body.className;\n      body.className = currentClass == \"dark-mode\" ? \"light-mode\" : \"dark-mode\";\n    };\n\n    _this.user = null;\n    _this.state = {\n      username: '',\n      balance: '',\n      stock: _this.props.match.params.name //this.handleChange = this.handleChange.bind(this);\n      //this.handleSubmitStock = this.handleSubmitStock.bind(this);\n\n    };\n    return _this;\n  }\n\n  _createClass(Stocks, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.user = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).onSnapshot(function (docSnapshot) {\n        console.log(\"Received doc snapshot: docSnapshot\", docSnapshot.data());\n\n        _this2.setState({\n          balance: docSnapshot.data().balance,\n          username: docSnapshot.data().username,\n          stock: _this2.props.match.params.name\n        }); // ...\n\n      }, function (err) {\n        console.log(\"Encountered error: \".concat(err));\n      });\n      this.bets = this.props.firebase.db.collection(\"Bets\").where('stockId', '==', this.props.match.params.name).onSnapshot(function (querySnapshot) {\n        console.log(\"Received query snapshot of size \".concat(querySnapshot.size));\n        document.getElementById(\"bodyBets\").innerHTML = \"\";\n        querySnapshot.forEach(function (element) {\n          _this2.renderBets(element, element.id); //element.data().id = element.id;\n          //this.state.betsList.push(element.data());\n\n        });\n        console.log(querySnapshot, _this2.state.betsList);\n      }, function (err) {\n        console.log(\"Encountered error: \".concat(err));\n      });\n      this.props.firebase.db.collection(\"Stocks\").doc(this.props.match.params.name).onSnapshot(function (docSnapshot) {\n        console.log(\"Received doc snapshot: docSnapshot\", docSnapshot.data());\n\n        _this2.setState({\n          balance: _this2.state.balance,\n          username: _this2.state.username,\n          address: docSnapshot.data().address,\n          ceo: docSnapshot.data().ceo,\n          companyURL: docSnapshot.data().companyURL,\n          description: docSnapshot.data().description,\n          employees: docSnapshot.data().employees,\n          name: docSnapshot.data().name,\n          price: docSnapshot.data().price,\n          stockExchange: docSnapshot.data().stockExchange,\n          ticker: docSnapshot.data().ticker,\n          time_updated: docSnapshot.data().time_updated,\n          nOfBets: docSnapshot.data().nOfBets,\n          betsToday: docSnapshot.data().betsToday,\n          lastBetDate: docSnapshot.data().lastBetDate ? new Date(docSnapshot.data().lastBetDate.seconds * 1000) : new Date()\n        }); // ...\n\n      }, function (err) {\n        console.log(\"Encountered error: \".concat(err));\n      });\n      this.viewNews();\n      this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"favorites\").doc(this.props.match.params.name).get().then(function (docSnapshot) {\n        if (docSnapshot.exists) {\n          document.getElementById('fav').innerText = 'Un-favorite';\n        }\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.user();\n      this.bets();\n    }\n  }, {\n    key: \"renderBets\",\n    value: function renderBets(bet, index) {\n      //var db = this.props.firebase.db;\n      var row = document.createElement('tr');\n      row.setAttribute('id', bet.id);\n      /*\n      var stockIdTD = document.createElement('td');\n      stockIdTD.textContent = bet.data().stockId; */\n\n      var betTD = document.createElement('td');\n      betTD.textContent = bet.data().bet;\n      var dirTD = document.createElement('td');\n      dirTD.textContent = bet.data().direction; //del.appendChild(delBut);\n      //row.appendChild(stockIdTD);\n\n      row.appendChild(betTD);\n      row.appendChild(dirTD);\n      document.getElementById(\"bodyBets\").appendChild(row);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(AuthUserContext.Consumer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, function (authUser) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115\n          },\n          __self: this\n        }, React.createElement(\"body\", {\n          id: \"body\",\n          class: \"light-mode\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 116\n          },\n          __self: this\n        }, React.createElement(Button, {\n          color: \"primary\",\n          name: \"dark_light\",\n          onClick: _this3.toggleDarkLight,\n          title: \"Toggle dark/light mode\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117\n          },\n          __self: this\n        }, \"Change Theme\"), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        }, React.createElement(Row, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 119\n          },\n          __self: this\n        }, React.createElement(Col, {\n          sm: \"5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 120\n          },\n          __self: this\n        }, React.createElement(Card, {\n          body: true,\n          inverse: true,\n          color: \"info\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 121\n          },\n          __self: this\n        }, React.createElement(CardText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122\n          },\n          __self: this\n        }, React.createElement(Button, {\n          color: \"success\",\n          id: \"fav\",\n          onClick: _this3.handleFavorite.bind(_this3),\n          type: \"submit\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }, \"Favorite\"), React.createElement(Alert, {\n          color: \"primary\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 125\n          },\n          __self: this\n        }, \"Name: \", _this3.state.name)), React.createElement(Alert, {\n          color: \"info\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 127\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 128\n          },\n          __self: this\n        }, \"Address: \", _this3.state.address), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 128\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          color: \"secondary\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 130\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131\n          },\n          __self: this\n        }, \"Ceo: \", _this3.state.ceo), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          color: \"warning\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        }, \"CompanyURL: \", _this3.state.companyURL), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          color: \"success\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137\n          },\n          __self: this\n        }, \"Employees: \", _this3.state.employees), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          color: \"dark\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 139\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        }, \"StockExchange: \", _this3.state.stockExchange), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          color: \"danger\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, \"Price: \", _this3.state.price), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          color: \"light\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146\n          },\n          __self: this\n        }, \"TimeUpdated: \", _this3.state.time_updated), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146\n          },\n          __self: this\n        }))))), React.createElement(Col, {\n          sm: \"7\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, React.createElement(\"h4\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, \"Description\"), React.createElement(Card, {\n          body: true,\n          inverse: true,\n          color: \"info\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 153\n          },\n          __self: this\n        }, React.createElement(CardText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154\n          },\n          __self: this\n        }, React.createElement(Alert, {\n          color: \"warning\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155\n          },\n          __self: this\n        }, React.createElement(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 156\n          },\n          __self: this\n        }, _this3.state.description), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 156\n          },\n          __self: this\n        })))), React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        }, \"Bet\"), React.createElement(Input, {\n          type: \"number\",\n          name: \"tokens\",\n          id: \"tokens\",\n          placeholder: \"Enter a amount to bet\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        }), React.createElement(Button, {\n          color: \"success\",\n          block: true,\n          size: \"lg\",\n          id: \"up\",\n          onClick: _this3.handleUp.bind(_this3),\n          type: \"submit\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          },\n          __self: this\n        }, \" Up \"), React.createElement(Button, {\n          color: \"danger\",\n          block: true,\n          size: \"lg\",\n          id: \"down\",\n          onClick: _this3.handleDown.bind(_this3),\n          type: \"submit\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163\n          },\n          __self: this\n        }, \" Down \"), React.createElement(\"h5\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        }, \"You currently have\", React.createElement(\"span\", {\n          className: _this3.getBadgeClasses(),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        }, _this3.formatNumberOfTokensLeft()), \" number of tokens.\")))), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171\n          },\n          __self: this\n        }, React.createElement(Row, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, React.createElement(Col, {\n          sm: \"5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        }, React.createElement(Table, {\n          striped: true,\n          hover: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }, React.createElement(\"thead\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }, React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, \"Tokens bet on \", _this3.props.match.params.name), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, \"Up/Down\"))), React.createElement(\"tbody\", {\n          id: \"bodyBets\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }))), React.createElement(Col, {\n          sm: \"5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186\n          },\n          __self: this\n        }, React.createElement(TradingViewWidget, {\n          symbol: _this3.props.match.params.name,\n          theme: Themes.LIGHT,\n          locale: \"en\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187\n          },\n          __self: this\n        })))), React.createElement(\"h4\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        }, \" Stock News\"), React.createElement(\"div\", {\n          id: \"news\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192\n          },\n          __self: this\n        })));\n      });\n    }\n  }, {\n    key: \"handleUp\",\n    value: function handleUp(e) {\n      e.preventDefault();\n      this.handleSubmit('Up');\n      console.log('Up');\n    }\n  }, {\n    key: \"handleDown\",\n    value: function handleDown(e) {\n      e.preventDefault();\n      this.handleSubmit('Down');\n      console.log('Down');\n    }\n  }, {\n    key: \"handleFavorite\",\n    value: function handleFavorite(e) {\n      if (document.getElementById('fav').innerText === 'Favorite') {\n        console.log('favoriting');\n        var ticker = this.props.match.params.name;\n        var userDoc = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"favorites\").doc(ticker);\n        userDoc.set({\n          Ticker: ticker,\n          price: this.state.price\n        });\n        document.getElementById('fav').innerText = 'Un-favorite';\n      } else {\n        console.log('unfavoriting');\n        var ticker = this.props.match.params.name;\n        var userDoc = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"favorites\").doc(ticker).delete();\n        document.getElementById('fav').innerText = 'Favorite';\n      }\n    }\n  }, {\n    key: \"handleSubmit\",\n    value: function handleSubmit(dir) {\n      var _this4 = this;\n\n      //e.preventDefault();\n      var stock = this.props.match.params.name;\n      var tokens = document.getElementById('tokens').value;\n      var date = new Date();\n      date.setHours(0, 0, 0); //var betsToday;\n\n      if (tokens !== \"\" && this.state.balance - tokens >= 0) {\n        var bets = this.state.nOfBets === undefined ? 0 : this.state.nOfBets;\n        var betsToday = this.state.betsToday === undefined ? 0 : this.state.betsToday;\n\n        if (this.state.lastBetDate < date) {\n          betsToday = 0;\n        }\n\n        this.props.firebase.db.collection(\"Stocks\").doc(this.props.match.params.name).update({\n          nOfBets: bets + 1,\n          betsToday: betsToday + 1,\n          lastBetDate: new Date()\n        });\n        console.log(this.props.firebase.auth.O);\n        var userDoc = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O);\n        userDoc.set({\n          balance: this.state.balance - tokens\n        }, {\n          merge: true\n        }); //TODO: bets collection\n\n        this.props.firebase.db.collection(\"Bets\").add({\n          userDoc: userDoc,\n          stockId: stock,\n          direction: dir,\n          timestamp: new Date(),\n          username: this.state.username,\n          bet: tokens\n        });\n      }\n      /* \n      TODO retreive bets for current period\n      */\n\n\n      this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).get().then(function (data) {\n        _this4.setState({\n          data: data\n        });\n\n        console.log(data.data().balance);\n\n        _this4.setState({\n          balance: data.data().balance\n        });\n      });\n\n      if (this.state.balance < 100) {\n        this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"notifications\").where('type', '==', 'lowTokens').where(\"active\", '==', true).get().then(function (docSnapshot) {\n          if (docSnapshot.size === 0) {\n            _this4.props.firebase.db.collection(\"Users\").doc(_this4.props.firebase.auth.O).collection(\"notifications\").add({\n              message: 'You have less than 100 tokens left, go to the account section to add tokens.',\n              active: true,\n              type: 'lowTokens',\n              time: new Date()\n            });\n          }\n        }, function (err) {\n          console.log(\"Encountered error: \".concat(err));\n        });\n      }\n    }\n  }, {\n    key: \"getBadgeClasses\",\n    value: function getBadgeClasses() {\n      var classes = \"badge m-2 badge-\";\n      classes += this.state.balance === 0 ? \"warning\" : \"primary\";\n      return classes;\n    }\n  }, {\n    key: \"formatNumberOfTokensLeft\",\n    value: function formatNumberOfTokensLeft() {\n      var balance = this.state.balance;\n      return balance === 0 ? \"Zero\" : balance;\n    }\n  }, {\n    key: \"viewNews\",\n    value: function viewNews() {\n      document.getElementById('news').innerHTML = '';\n      var stock = this.props.match.params.name;\n      var url = 'https://newsapi.org/v2/everything?q=' + stock + '&apiKey=34c665fbab834d7c80356f0bf458b1a7';\n      fetch(url).then(function (response) {\n        return response.json();\n      }).then(function (data) {\n        console.log(data);\n\n        for (var i = 0; i < 12; i++) {\n          var title = data.articles[i].title;\n\n          if (title == null) {\n            title = \"\";\n          }\n\n          var desc = data.articles[i].description;\n          var auth = data.articles[i].author;\n          var link = data.articles[i].url;\n          var link1 = data.articles[i].urlToImage;\n          var date = data.articles[i].publishedAt;\n          document.getElementById('news').innerHTML += '<div class=\"item\"><h2 class=\"header\">' + title + '</h2>' + //character of escape: \"quotes\" and '+'\n          '<img src=\"' + link1 + '\">' + '<p class=\"publishedAt\">' + date + '</p>' + '<p>' + desc + '</p>' + '<p>' + auth + '</p>' + //character of escape: \"quotes\" and '+'\n          '<a href=\"' + link + '\">Read more</a></div>';\n        }\n      });\n    }\n  }]);\n\n  return Stocks;\n}(Component);\n\nvar condition = function condition(authUser) {\n  return !!authUser;\n};\n\nexport default withAuthorization(condition)(Stocks);","map":{"version":3,"sources":["/Users/yash/instinctiv/instinctiv/src/components/Stocks/index.js"],"names":["React","Component","AuthUserContext","withAuthorization","Input","Button","Col","Row","Label","Card","Alert","CardText","Table","TradingViewWidget","Themes","Stocks","props","toggleDarkLight","event","body","document","getElementById","currentClass","className","user","state","username","balance","stock","match","params","name","firebase","db","collection","doc","auth","O","onSnapshot","docSnapshot","console","log","data","setState","err","bets","where","querySnapshot","size","innerHTML","forEach","element","renderBets","id","betsList","address","ceo","companyURL","description","employees","price","stockExchange","ticker","time_updated","nOfBets","betsToday","lastBetDate","Date","seconds","viewNews","get","then","exists","innerText","bet","index","row","createElement","setAttribute","betTD","textContent","dirTD","direction","appendChild","authUser","handleFavorite","bind","handleUp","handleDown","getBadgeClasses","formatNumberOfTokensLeft","LIGHT","e","preventDefault","handleSubmit","userDoc","set","Ticker","delete","dir","tokens","value","date","setHours","undefined","update","merge","add","stockId","timestamp","message","active","type","time","classes","url","fetch","response","json","i","title","articles","desc","author","link","link1","urlToImage","publishedAt","condition"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { AuthUserContext, withAuthorization } from '../Session';\nimport { Input, Button, Col, Row, Label, Card, Alert, CardText, Table } from 'reactstrap';\nimport './stocks.css';\nimport TradingViewWidget, { Themes } from 'react-tradingview-widget'\n//import { Timestamp } from \"@google-cloud/firestore\";\n\nclass Stocks extends Component {\n\n  constructor(props){\n    super(props);\n    this.user = null;\n    this.state = {\n      username: '',\n      balance: '',\n      stock: this.props.match.params.name,\n    }\n    //this.handleChange = this.handleChange.bind(this);\n    //this.handleSubmitStock = this.handleSubmitStock.bind(this);\n  }\n\n  toggleDarkLight = event => {\n   var body = document.getElementById(\"body\");\n   var currentClass = body.className;\n   body.className = currentClass == \"dark-mode\" ? \"light-mode\" : \"dark-mode\";\n }\n\n  componentDidMount() {\n    this.user = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).onSnapshot(docSnapshot => {\n      console.log(`Received doc snapshot: docSnapshot`, docSnapshot.data());\n      this.setState({\n        balance: docSnapshot.data().balance,\n        username: docSnapshot.data().username,\n        stock: this.props.match.params.name\n      });      // ...\n    }, err => {\n      console.log(`Encountered error: ${err}`);\n    });\n\n    this.bets = this.props.firebase.db.collection(\"Bets\").where('stockId', '==', this.props.match.params.name).onSnapshot(querySnapshot => {\n      console.log(`Received query snapshot of size ${querySnapshot.size}`);\n      document.getElementById(\"bodyBets\").innerHTML = \"\";\n      querySnapshot.forEach(element => {\n          this.renderBets(element, element.id);\n        //element.data().id = element.id;\n        //this.state.betsList.push(element.data());\n      });\n      console.log(querySnapshot, this.state.betsList);\n    }, err => {\n      console.log(`Encountered error: ${err}`);\n    });\n\n    this.props.firebase.db.collection(\"Stocks\").doc(this.props.match.params.name).onSnapshot(docSnapshot => {\n      console.log(`Received doc snapshot: docSnapshot`, docSnapshot.data());\n      this.setState({\n        balance: this.state.balance,\n        username: this.state.username,\n        address: docSnapshot.data().address,\n        ceo: docSnapshot.data().ceo,\n        companyURL: docSnapshot.data().companyURL,\n        description: docSnapshot.data().description,\n        employees: docSnapshot.data().employees,\n        name: docSnapshot.data().name,\n        price: docSnapshot.data().price,\n        stockExchange: docSnapshot.data().stockExchange,\n        ticker: docSnapshot.data().ticker,\n        time_updated: docSnapshot.data().time_updated,\n        nOfBets: docSnapshot.data().nOfBets,\n        betsToday: docSnapshot.data().betsToday,\n        lastBetDate: docSnapshot.data().lastBetDate?(new Date(docSnapshot.data().lastBetDate.seconds*1000)):new Date(),\n      });      // ...\n    }, err => {\n      console.log(`Encountered error: ${err}`);\n    });\n    this.viewNews();\n\n    this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"favorites\").doc(this.props.match.params.name)\n      .get().then(docSnapshot => {\n        if(docSnapshot.exists){\n          document.getElementById('fav').innerText = 'Un-favorite';\n        }\n      });\n  }\n\n  componentWillUnmount(){\n    this.user();\n    this.bets();\n  }\n\n\n  renderBets(bet, index) {\n    //var db = this.props.firebase.db;\n    var row = document.createElement('tr');\n    row.setAttribute('id', bet.id);/*\n    var stockIdTD = document.createElement('td');\n    stockIdTD.textContent = bet.data().stockId; */\n    var betTD = document.createElement('td');\n    betTD.textContent = bet.data().bet;\n\n    var dirTD = document.createElement('td');\n    dirTD.textContent = bet.data().direction;\n    //del.appendChild(delBut);\n    //row.appendChild(stockIdTD);\n    row.appendChild(betTD);\n    row.appendChild(dirTD);\n\n    document.getElementById(\"bodyBets\").appendChild(row);\n\n  }\n\n  render() {\n    return (\n      <AuthUserContext.Consumer>\n      {authUser => (\n        <div>\n          <body id=\"body\" class=\"light-mode\">\n          <Button color=\"primary\" name=\"dark_light\" onClick= {this.toggleDarkLight} title=\"Toggle dark/light mode\">Change Theme</Button>\n          <div>\n            <Row>\n            <Col sm=\"5\">\n              <Card body inverse color=\"info\">\n        <CardText>\n            <Button color=\"success\" id=\"fav\" onClick={this.handleFavorite.bind(this)} type=\"submit\">Favorite</Button>\n            <Alert color=\"primary\">\n              <strong>Name: {this.state.name}</strong>\n            </Alert>\n            <Alert color=\"info\">\n              <strong>Address: {this.state.address}</strong><br/>\n            </Alert>\n            <Alert color=\"secondary\">\n              <strong>Ceo: {this.state.ceo}</strong><br/>\n            </Alert>\n            <Alert color=\"warning\">\n              <strong>CompanyURL: {this.state.companyURL}</strong><br/>\n            </Alert>\n            <Alert color=\"success\">\n              <strong>Employees: {this.state.employees}</strong><br/>\n            </Alert>\n            <Alert color=\"dark\">\n              <strong>StockExchange: {this.state.stockExchange}</strong><br/>\n            </Alert>\n            <Alert color=\"danger\">\n              <strong>Price: {this.state.price}</strong><br/>\n            </Alert>\n            <Alert color=\"light\">\n              <strong>TimeUpdated: {this.state.time_updated}</strong><br/>\n            </Alert>\n        </CardText>\n      </Card>\n          </Col>\n          <Col sm=\"7\">\n            <h4>Description</h4>\n            <Card body inverse color=\"info\">\n      <CardText>\n          <Alert color=\"warning\">\n            <strong>{this.state.description}</strong><br/>\n          </Alert>\n      </CardText>\n    </Card>\n    <h1>Bet</h1>\n    <Input type=\"number\" name=\"tokens\" id=\"tokens\" placeholder=\"Enter a amount to bet\"/>\n    <Button color = \"success\" block size=\"lg\" id=\"up\" onClick={this.handleUp.bind(this)} type=\"submit\"> Up </Button>\n    <Button color = \"danger\" block size=\"lg\"id=\"down\" onClick={this.handleDown.bind(this)} type=\"submit\"> Down </Button>\n\n      <h5>You currently have<span className={this.getBadgeClasses()}>\n        {this.formatNumberOfTokensLeft()}\n      </span> number of tokens.</h5>\n        </Col>\n          </Row>\n          </div>\n          <div>\n            <Row>\n              <Col sm=\"5\">\n            <Table striped hover>\n              <thead>\n                <tr>\n                  <th>Tokens bet on {this.props.match.params.name}</th>\n                  <th>Up/Down</th>\n                </tr>\n              </thead>\n              <tbody id='bodyBets'>\n\n              </tbody>\n            </Table>\n            </Col>\n            <Col sm=\"5\">\n            <TradingViewWidget symbol={this.props.match.params.name} theme={Themes.LIGHT} locale=\"en\"/>\n            </Col>\n            </Row>\n          </div>\n          <h4> Stock News</h4>\n          <div id=\"news\"></div>{/* <Button outline color=\"primary\" onClick={this.viewNews} block>Search</Button> */}\n          </body>\n        </div>\n\n      )}\n      </AuthUserContext.Consumer>\n    );\n  }\n\n  handleUp(e){\n    e.preventDefault();\n    this.handleSubmit('Up');\n    console.log('Up');\n  }\n\n  handleDown(e){\n    e.preventDefault();\n    this.handleSubmit('Down');\n    console.log('Down');\n  }\n\n  handleFavorite(e){\n\n    if(document.getElementById('fav').innerText === 'Favorite'){\n      console.log('favoriting');\n      var ticker = this.props.match.params.name;\n      var userDoc = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"favorites\").doc(ticker)\n      userDoc.set({\n        Ticker: ticker,\n        price: this.state.price\n      })\n      document.getElementById('fav').innerText = 'Un-favorite';\n\n\n    }else{\n      console.log('unfavoriting');\n      var ticker = this.props.match.params.name;\n      var userDoc = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"favorites\").doc(ticker).delete();\n      document.getElementById('fav').innerText = 'Favorite';\n    }\n\n  }\n\n  handleSubmit(dir) {\n\n    //e.preventDefault();\n    var stock = this.props.match.params.name;\n    var tokens = document.getElementById('tokens').value;\n    var date = new Date();\n    date.setHours(0,0,0);\n    //var betsToday;\n    \n    if(tokens !==  \"\" && this.state.balance-tokens  >= 0){\n      var bets = this.state.nOfBets ===undefined ? 0:this.state.nOfBets; \n      var betsToday = this.state.betsToday ===undefined ? 0:this.state.betsToday; \n      if(this.state.lastBetDate < date){\n        betsToday = 0;\n      }\n\n      this.props.firebase.db.collection(\"Stocks\").doc(this.props.match.params.name).update({\n        nOfBets: bets +1 ,\n        betsToday: betsToday + 1,\n        lastBetDate: new Date(),\n      });\n\n      console.log(this.props.firebase.auth.O);\n      var userDoc = this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O);\n      userDoc.set({\n        balance: (this.state.balance-tokens)\n      }, {merge: true});\n      //TODO: bets collection\n      this.props.firebase.db.collection(\"Bets\").add({\n        userDoc: userDoc,\n        stockId: stock,\n        direction: dir,\n        timestamp: new Date(),\n        username: this.state.username,\n        bet: tokens\n      });\n    }\n    /* \n    TODO retreive bets for current period\n    */\n    this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).get().then(data => {\n        this.setState({data: data});\n        console.log(data.data().balance);\n        this.setState({\n          balance: data.data().balance,\n        })\n      }\n    )\n    if(this.state.balance < 100){\n      this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O)\n      .collection(\"notifications\")\n      .where('type', '==', 'lowTokens')\n            .where(\"active\", '==', true).get().then(docSnapshot => {\n                if(docSnapshot.size===0){\n                this.props.firebase.db.collection(\"Users\").doc(this.props.firebase.auth.O).collection(\"notifications\").add({\n                  message: 'You have less than 100 tokens left, go to the account section to add tokens.',\n                  active: true,\n                  type: 'lowTokens',\n                  time: new Date(),\n                });\n              }\n              }, err => {\n                console.log(`Encountered error: ${err}`);\n              });\n\n    }\n  }\n\n\n\n  getBadgeClasses() {\n    let classes = \"badge m-2 badge-\";\n    classes += this.state.balance === 0 ? \"warning\" : \"primary\";\n    return classes;\n  }\n\n  formatNumberOfTokensLeft() {\n    const { balance } = this.state;\n    return balance === 0 ? \"Zero\" : balance;\n  }\n\n  viewNews() {\n     document.getElementById('news').innerHTML ='';\n     var stock = this.props.match.params.name;\n     var url = 'https://newsapi.org/v2/everything?q='\n               + stock  +\n               '&apiKey=34c665fbab834d7c80356f0bf458b1a7';\n\n     fetch(url)\n       .then(response => response.json())\n       .then(data => {\n         console.log(data);\n\n       for(var i=0; i < 12; i++){\n\n         var title = data.articles[i].title;\n\n         if(title == null){\n           title =\"\";\n         }\n         var desc = data.articles[i].description;\n         var auth = data.articles[i].author;\n         var link = data.articles[i].url;\n         var link1 = data.articles[i].urlToImage;\n         var date = data.articles[i].publishedAt;\n\n\n\n\n       document.getElementById('news').innerHTML += '<div class=\"item\"><h2 class=\"header\">' + title + '</h2>' +\n                  //character of escape: \"quotes\" and '+'\n         '<img src=\"' + link1 +'\">' +\n         '<p class=\"publishedAt\">' + date + '</p>' +\n         '<p>' + desc + '</p>' +\n         '<p>' + auth + '</p>' +\n                  //character of escape: \"quotes\" and '+'\n         '<a href=\"'+ link +'\">Read more</a></div>'\n         ;\n\n     }\n     });\n\n   }\n\n}\n\n\n\nconst condition = authUser => !!authUser;\n\nexport default withAuthorization(condition)(Stocks);\n"]},"metadata":{},"sourceType":"module"}